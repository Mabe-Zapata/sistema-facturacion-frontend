@using System
@using System.Globalization
@inject StateService stateService
@using BlazorColorPicker
@inject IColorPickerService ColorPickerService
@inject IActionService ActionService
@using Microsoft.JSInterop
@inject IJSRuntime JSRuntime
@inject NavScrollService? scrollService

<div class="offcanvas offcanvas-end" tabindex="-1" id="switcher-canvas" aria-labelledby="offcanvasRightLabel">
    <div class="offcanvas-header border-bottom">
        <h5 class="offcanvas-title text-default" id="offcanvasRightLabel">Switcher</h5>
        <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body">
        <nav class="border-bottom border-block-end-dashed">
            <div class="nav nav-tabs nav-justified" id="switcher-main-tab" role="tablist">
                <button class="nav-link active" id="switcher-home-tab" data-bs-toggle="tab"
                        data-bs-target="#switcher-home" type="button" role="tab" aria-controls="switcher-home"
                        aria-selected="true">
                    Theme Styles
                </button>
                <button class="nav-link" id="switcher-profile-tab" data-bs-toggle="tab"
                        data-bs-target="#switcher-profile" type="button" role="tab" aria-controls="switcher-profile"
                        aria-selected="false">
                    Theme Colors
                </button>
            </div>
        </nav>

        <div class="tab-content" id="nav-tabContent">
            <div class="tab-pane fade show active border-0" id="switcher-home" role="tabpanel"
                 aria-labelledby="switcher-home-tab" tabindex="0">

                <div>
                    <p class="switcher-style-head">Theme Color Mode:</p>
                    <div class="row switcher-style gx-0">
                        <div class="col-4">
                            <div class="form-check switch-select">
                                <label class="form-check-label" for="switcher-light-theme">Light</label>
                                <input class="form-check-input" type="radio" name="theme-style" id="switcher-light-theme"
                                       @onclick='() => colorthemeFn("light")'
                                       checked="@(currentState?.ColorTheme == "light")">
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="form-check switch-select">
                                <label class="form-check-label" for="switcher-dark-theme">Dark</label>
                                <input class="form-check-input" type="radio" name="theme-style" id="switcher-dark-theme"
                                       @onclick='() => colorthemeFn("dark")'
                                       checked="@(currentState?.ColorTheme == "dark")">
                            </div>
                        </div>
                    </div>
                </div>

                <div>
                    <p class="switcher-style-head">Directions:</p>
                    <div class="row switcher-style gx-0">
                        <div class="col-4">
                            <div class="form-check switch-select">
                                <label class="form-check-label" for="switcher-ltr">LTR</label>
                                <input class="form-check-input" type="radio" name="direction" id="switcher-ltr"
                                       @onclick='() => directionFn("ltr")'
                                       checked="@(currentState?.Direction == "ltr")">
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="form-check switch-select">
                                <label class="form-check-label" for="switcher-rtl">RTL</label>
                                <input class="form-check-input" type="radio" name="direction" id="switcher-rtl"
                                       @onclick='() => directionFn("rtl")'
                                       checked="@(currentState?.Direction == "rtl")">
                            </div>
                        </div>
                    </div>
                </div>

                <div>
                    <p class="switcher-style-head">Navigation Styles:</p>
                    <div class="row switcher-style gx-0">
                        <div class="col-4">
                            <div class="form-check switch-select">
                                <label class="form-check-label" for="switcher-vertical">Vertical</label>
                                <input class="form-check-input" type="radio" name="navigation-style" id="switcher-vertical"
                                       @onclick='() => navigationStylesFn("vertical")'
                                       checked="@(currentState?.NavigationStyles == "vertical")">
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="form-check switch-select">
                                <label class="form-check-label" for="switcher-horizontal">Horizontal</label>
                                <input class="form-check-input" type="radio" name="navigation-style" id="switcher-horizontal"
                                       @onclick='() => navigationStylesFn("horizontal")'
                                       checked="@(currentState?.NavigationStyles == "horizontal")">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="navigation-menu-styles">
                    <p class="switcher-style-head">Vertical & Horizontal Menu Styles:</p>
                    <div class="row switcher-style gx-0 gy-2 pb-2">
                        <div class="col-4">
                            <div class="form-check switch-select">
                                <label class="form-check-label" for="switcher-menu-click">Menu Click</label>
                                <input class="form-check-input" type="radio" name="navigation-menu-styles"
                                       id="switcher-menu-click" @onclick='() => menuStylesFn("menu-click")'
                                       checked="@(currentState?.MenuStyles == "menu-click")">
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="form-check switch-select">
                                <label class="form-check-label" for="switcher-menu-hover">Menu Hover</label>
                                <input class="form-check-input" type="radio" name="navigation-menu-styles"
                                       id="switcher-menu-hover" @onclick='() => menuStylesFn("menu-hover")'
                                       checked="@(currentState?.MenuStyles == "menu-hover")">
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="form-check switch-select">
                                <label class="form-check-label" for="switcher-icon-click">Icon Click</label>
                                <input class="form-check-input" type="radio" name="navigation-menu-styles"
                                       id="switcher-icon-click" @onclick='() => menuStylesFn("icon-click")'
                                       checked="@(currentState?.MenuStyles == "icon-click")">
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="form-check switch-select">
                                <label class="form-check-label" for="switcher-icon-hover">Icon Hover</label>
                                <input class="form-check-input" type="radio" name="navigation-menu-styles"
                                       id="switcher-icon-hover" @onclick='() => menuStylesFn("icon-hover")'
                                       checked="@(currentState?.MenuStyles == "icon-hover")">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="sidemenu-layout-styles">
                    <p class="switcher-style-head">Sidemenu Layout Styles:</p>
                    <div class="row switcher-style gx-0 gy-2 pb-2">
                        <div class="col-sm-6">
                            <div class="form-check switch-select">
                                <label class="form-check-label" for="switcher-default-menu">Default Menu</label>
                                <input class="form-check-input" type="radio" name="sidemenu-layout-styles"
                                       id="switcher-default-menu" @onclick='() => layoutStylesFn("default-menu")'
                                       checked="@(currentState?.LayoutStyles == "default-menu")">
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="form-check switch-select">
                                <label class="form-check-label" for="switcher-closed-menu">Closed Menu</label>
                                <input class="form-check-input" type="radio" name="sidemenu-layout-styles"
                                       id="switcher-closed-menu" @onclick='() => layoutStylesFn("closed-menu")'
                                       checked="@(currentState?.LayoutStyles == "closed-menu")">
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="form-check switch-select">
                                <label class="form-check-label" for="switcher-icontext-menu">Icon Text</label>
                                <input class="form-check-input" type="radio" name="sidemenu-layout-styles"
                                       id="switcher-icontext-menu" @onclick='() => layoutStylesFn("icontext-menu")'
                                       checked="@(currentState?.LayoutStyles == "icontext-menu")">
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="form-check switch-select">
                                <label class="form-check-label" for="switcher-icon-overlay">Icon Overlay</label>
                                <input class="form-check-input" type="radio" name="sidemenu-layout-styles"
                                       id="switcher-icon-overlay" @onclick='() => layoutStylesFn("icon-overlay")'
                                       checked="@(currentState?.LayoutStyles == "icon-overlay")">
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="form-check switch-select">
                                <label class="form-check-label" for="switcher-detached">Detached</label>
                                <input class="form-check-input" type="radio" name="sidemenu-layout-styles"
                                       id="switcher-detached" @onclick='() => layoutStylesFn("detached")'
                                       checked="@(currentState?.LayoutStyles == "detached")">
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="form-check switch-select">
                                <label class="form-check-label" for="switcher-double-menu">Double Menu</label>
                                <input class="form-check-input" type="radio" name="sidemenu-layout-styles"
                                       id="switcher-double-menu" @onclick='() => layoutStylesFn("double-menu")'
                                       checked="@(currentState?.LayoutStyles == "double-menu"
                                                                                      || currentState?.MenuStyles == "icon-hover"
                                                                                      || currentState?.MenuStyles == "icon-click"
                                                                                      || currentState?.MenuStyles == "menu-click"
                                                                                      || currentState?.MenuStyles == "menu-hover")">
                            </div>
                        </div>
                    </div>
                </div>

                <div>
                    <p class="switcher-style-head">Page Styles:</p>
                    <div class="row switcher-style gx-0">
                        <div class="col-xl-3 col-6">
                            <div class="form-check switch-select" @onclick='() => pageStyleFn("regular")'>
                                <label class="form-check-label" for="switcher-regular">Regular</label>
                                <input class="form-check-input" type="radio" name="page-styles" id="switcher-regular"
                                       checked="@(currentState?.PageStyles == "regular")">
                            </div>
                        </div>
                        <div class="col-xl-3 col-6" @onclick='() => pageStyleFn("classic")'>
                            <div class="form-check switch-select">
                                <label class="form-check-label" for="switcher-classic">Classic</label>
                                <input class="form-check-input" type="radio" name="page-styles" id="switcher-classic"
                                       checked="@(currentState?.PageStyles == "classic")">
                            </div>
                        </div>
                        <div class="col-xl-3 col-6" @onclick='() => pageStyleFn("modern")'>
                            <div class="form-check switch-select">
                                <label class="form-check-label" for="switcher-modern">Modern</label>
                                <input class="form-check-input" type="radio" name="page-styles" id="switcher-modern"
                                       checked="@(currentState?.PageStyles == "modern")">
                            </div>
                        </div>
                        <div class="col-xl-3 col-6" @onclick='() => pageStyleFn("flat")'>
                            <div class="form-check switch-select">
                                <label class="form-check-label" for="switcher-flat">Flat</label>
                                <input class="form-check-input custom" type="radio" name="page-styles" id="switcher-flat"
                                       checked="@(currentState?.PageStyles == "flat")">
                            </div>
                        </div>
                    </div>
                </div>

                <div>
                    <p class="switcher-style-head">Layout Width Styles:</p>
                    <div class="row switcher-style gx-0">
                        <div class="col-4">
                            <div class="form-check switch-select">
                                <label class="form-check-label" for="switcher-default-width">Default</label>
                                <input class="form-check-input" type="radio" name="layout-width"
                                       id="switcher-default-width" @onclick='() => widthStylessFn("default")'
                                       checked="@(currentState?.WidthStyles == "default")">
                            </div>
                        </div>
                        <div class="col-5">
                            <div class="form-check switch-select">
                                <label class="form-check-label" for="switcher-full-width">Full Width</label>
                                <input class="form-check-input custom" type="radio" name="layout-width"
                                       id="switcher-full-width" @onclick='() => widthStylessFn("full-width")'
                                       checked="@(currentState?.WidthStyles == "full-width")">
                            </div>
                        </div>
                        <div class="col-3">
                            <div class="form-check switch-select">
                                <label class="form-check-label" for="switcher-boxed">Boxed</label>
                                <input class="form-check-input" type="radio" name="layout-width" id="switcher-boxed"
                                       @onclick='() => widthStylessFn("boxed")'
                                       checked="@(currentState?.WidthStyles == "boxed")">
                            </div>
                        </div>
                    </div>
                </div>

                <div>
                    <p class="switcher-style-head">Menu Positions:</p>
                    <div class="row switcher-style gx-0">
                        <div class="col-4">
                            <div class="form-check switch-select">
                                <label class="form-check-label" for="switcher-menu-fixed">Fixed</label>
                                <input class="form-check-input" type="radio" name="menu-positions"
                                       id="switcher-menu-fixed" @onclick='() => menuPositionFn("fixed")'
                                       checked="@(currentState?.MenuPosition == "fixed")">
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="form-check switch-select">
                                <label class="form-check-label" for="switcher-menu-scroll">Scrollable</label>
                                <input class="form-check-input" type="radio" name="menu-positions"
                                       id="switcher-menu-scroll" @onclick='() => menuPositionFn("scrollable")'
                                       checked="@(currentState?.MenuPosition == "scrollable")">
                            </div>
                        </div>
                    </div>
                </div>

                <div>
                    <p class="switcher-style-head">Header Positions:</p>
                    <div class="row switcher-style gx-0">
                        <div class="col-4">
                            <div class="form-check switch-select">
                                <label class="form-check-label" for="switcher-header-fixed">Fixed</label>
                                <input class="form-check-input" type="radio" name="header-positions"
                                       id="switcher-header-fixed" @onclick='() => headerPositionFn("fixed")'
                                       checked="@(currentState?.HeaderPosition == "fixed")">
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="form-check switch-select">
                                <label class="form-check-label" for="switcher-header-scroll">Scrollable</label>
                                <input class="form-check-input" type="radio" name="header-positions"
                                       id="switcher-header-scroll" @onclick='() => headerPositionFn("scrollable")'
                                       checked="@(currentState?.HeaderPosition == "scrollable")">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="tab-pane fade border-0" id="switcher-profile" role="tabpanel"
                 aria-labelledby="switcher-profile-tab" tabindex="0">
                <div>
                    <div class="theme-colors">
                        <p class="switcher-style-head">Menu Colors:</p>
                        <div class="d-flex switcher-style pb-2">
                            <div class="form-check switch-select me-3">
                                <input class="form-check-input color-input color-white" data-bs-toggle="tooltip"
                                       data-bs-placement="top" title="Light Menu" type="radio" name="menu-colors"
                                       id="switcher-menu-light" @onclick='() => menuColorFn("light")'
                                       checked="@(currentState?.MenuColor == "light")">
                            </div>
                            <div class="form-check switch-select me-3">
                                <input class="form-check-input color-input color-dark" data-bs-toggle="tooltip"
                                       data-bs-placement="top" title="Dark Menu" type="radio" name="menu-colors"
                                       id="switcher-menu-dark" @onclick='() => menuColorFn("dark")'
                                       checked="@(currentState?.MenuColor == "dark")">
                            </div>
                            <div class="form-check switch-select me-3">
                                <input class="form-check-input color-input color-primary" data-bs-toggle="tooltip"
                                       data-bs-placement="top" title="Color Menu" type="radio" name="menu-colors"
                                       id="switcher-menu-primary" @onclick='() => menuColorFn("color")'
                                       checked="@(currentState?.MenuColor == "color")">
                            </div>
                            <div class="form-check switch-select me-3">
                                <input class="form-check-input color-input color-gradient" data-bs-toggle="tooltip"
                                       data-bs-placement="top" title="Gradient Menu" type="radio" name="menu-colors"
                                       id="switcher-menu-gradient" @onclick='() => menuColorFn("gradient")'
                                       checked="@(currentState?.MenuColor == "gradient")">
                            </div>
                            <div class="form-check switch-select me-3">
                                <input class="form-check-input color-input color-transparent" data-bs-toggle="tooltip"
                                       data-bs-placement="top" title="Transparent Menu" type="radio" name="menu-colors"
                                       id="switcher-menu-transparent" @onclick='() => menuColorFn("transparent")'
                                       checked="@(currentState?.MenuColor == "transparent")">
                            </div>
                        </div>
                        <div class="text-muted fs-11 px-4 pb-3">
                            Note:If you want to change color Menu dynamically change
                            from below Theme Primary color picker
                        </div>
                    </div>

                    <div class="theme-colors">
                        <p class="switcher-style-head">Header Colors:</p>
                        <div class="d-flex switcher-style pb-2">
                            <div class="form-check switch-select me-3">
                                <input class="form-check-input color-input color-white" data-bs-toggle="tooltip"
                                       data-bs-placement="top" title="Light Header" type="radio" name="header-colors"
                                       id="switcher-header-light" @onclick='() => headerColorFn("light")'
                                       checked="@(currentState?.HeaderColor == "light")">
                            </div>
                            <div class="form-check switch-select me-3">
                                <input class="form-check-input color-input color-dark" data-bs-toggle="tooltip"
                                       data-bs-placement="top" title="Dark Header" type="radio" name="header-colors"
                                       id="switcher-header-dark" @onclick='() => headerColorFn("dark")'
                                       checked="@(currentState?.HeaderColor == "dark")">
                            </div>
                            <div class="form-check switch-select me-3">
                                <input class="form-check-input color-input color-primary" data-bs-toggle="tooltip"
                                       data-bs-placement="top" title="Color Header" type="radio" name="header-colors"
                                       id="switcher-header-primary" @onclick='() => headerColorFn("color")'
                                       checked="@(currentState?.HeaderColor == "color")">
                            </div>
                            <div class="form-check switch-select me-3">
                                <input class="form-check-input color-input color-gradient" data-bs-toggle="tooltip"
                                       data-bs-placement="top" title="Gradient Header" type="radio" name="header-colors"
                                       id="switcher-header-gradient" @onclick='() => headerColorFn("gradient")'
                                       checked="@(currentState?.HeaderColor == "gradient")">
                            </div>
                            <div class="form-check switch-select me-3">
                                <input class="form-check-input color-input color-transparent" data-bs-toggle="tooltip"
                                       data-bs-placement="top" title="Transparent Header" type="radio" name="header-colors"
                                       id="switcher-header-transparent" @onclick='() => headerColorFn("transparent")'
                                       checked="@(currentState?.HeaderColor == "transparent")">
                            </div>
                        </div>
                        <div class="text-muted fs-11 px-4 pb-3">
                            Note:If you want to change color Header dynamically
                            change from below Theme Primary color picker
                        </div>
                    </div>

                    <div class="theme-colors">
                        <p class="switcher-style-head">Theme Primary:</p>
                        <div class="d-flex align-items-center switcher-style">
                            <div class="form-check switch-select me-3">
                                <input class="form-check-input color-input color-primary-1" type="radio" name="theme-primary"
                                       id="switcher-primary" @onclick='() => themePrimaryFn("42, 16, 164")'
                                       checked="@(currentState?.ThemePrimary == "42, 16, 164")">
                            </div>
                            <div class="form-check switch-select me-3">
                                <input class="form-check-input color-input color-primary-2" type="radio" name="theme-primary"
                                       id="switcher-primary1" @onclick='() => themePrimaryFn("125, 0, 189")'
                                       checked="@(currentState?.ThemePrimary == "125, 0, 189")">
                            </div>
                            <div class="form-check switch-select me-3">
                                <input class="form-check-input color-input color-primary-3" type="radio" name="theme-primary"
                                       id="switcher-primary2" @onclick='() => themePrimaryFn("4, 118, 141")'
                                       checked="@(currentState?.ThemePrimary == "4, 118, 141")">
                            </div>
                            <div class="form-check switch-select me-3">
                                <input class="form-check-input color-input color-primary-4" type="radio" name="theme-primary"
                                       id="switcher-primary3" @onclick='() => themePrimaryFn("138, 0, 32")'
                                       checked="@(currentState?.ThemePrimary == "138, 0, 32")">
                            </div>
                            <div class="form-check switch-select me-3">
                                <input class="form-check-input color-input color-primary-5" type="radio" name="theme-primary"
                                       id="switcher-primary4" @onclick='() => themePrimaryFn("9, 124, 103")'
                                       checked="@(currentState?.ThemePrimary == "9, 124, 103")">
                            </div>
                            <div class="form-check switch-select color-primary-light ps-0">
                                <a href="javascript:void(0);" @onclick="PrimaryModal">
                                    <div style="background-color:rgb(132,90,223)" class="buttonColor m-0"></div>
                                </a>
                            </div>
                        </div>
                    </div>

                    <div class="theme-colors">
                        <p class="switcher-style-head">Theme Background:</p>
                        <div class="d-flex align-items-center switcher-style">
                            <div class="form-check switch-select me-3">
                                <input class="form-check-input color-input color-bg-1" type="radio" name="theme-background"
                                       id="switcher-background"
                                       @onclick='() => themeBackgroundFn("0, 8, 52", "14, 22, 66")'
                                       checked="@(currentState?.ThemeBackground == "0, 8, 52")">
                            </div>
                            <div class="form-check switch-select me-3">
                                <input class="form-check-input color-input color-bg-2" type="radio" name="theme-background"
                                       id="switcher-background1"
                                       @onclick='() => themeBackgroundFn("58, 0, 109", "72, 14, 123")'
                                       checked="@(currentState?.ThemeBackground == "58, 0, 109")">
                            </div>
                            <div class="form-check switch-select me-3">
                                <input class="form-check-input color-input color-bg-3" type="radio" name="theme-background"
                                       id="switcher-background2"
                                       @onclick='() => themeBackgroundFn("0, 59, 70", "14, 73, 84")'
                                       checked="@(currentState?.ThemeBackground == "0, 59, 70")">
                            </div>
                            <div class="form-check switch-select me-3">
                                <input class="form-check-input color-input color-bg-4" type="radio" name="theme-background"
                                       id="switcher-background3"
                                       @onclick='() => themeBackgroundFn("65, 0, 0", "79, 14, 14")'
                                       checked="@(currentState?.ThemeBackground == "65, 0, 0")">
                            </div>
                            <div class="form-check switch-select me-3">
                                <input class="form-check-input color-input color-bg-5" type="radio" name="theme-background"
                                       id="switcher-background4"
                                       @onclick='() => themeBackgroundFn("1, 77, 46", "15, 91, 60")'
                                       checked="@(currentState?.ThemeBackground == "1, 77, 46")">
                            </div>
                            <div class="form-check switch-select color-primary-light ps-0">
                                <a href="javascript:void(0);" @onclick="BackgroundModal">
                                    <div style="background-color:rgb(132,90,223)" class="buttonColor m-0"></div>
                                </a>
                            </div>
                        </div>
                    </div>

                    <div class="menu-image mb-3">
                        <p class="switcher-style-head">Menu With Background Image:</p>
                        <div class="d-flex align-items-center switcher-style flex-wrap">
                            <div class="form-check switch-select menu-img-select m-2">
                                <input class="form-check-input bgimage-input bg-img1" type="radio" name="menu-background"
                                       id="switcher-bg-img" @onclick='() => backgroundImageFn("bgimg1")'
                                       checked="@(currentState?.BackgroundImage == "bgimg1")">
                                <div class="bg-img-container"><img src="../assets/images/menu-bg-images/bg-img1.jpg" alt=""></div>
                            </div>
                            <div class="form-check switch-select menu-img-select m-2">
                                <input class="form-check-input bgimage-input bg-img2" type="radio" name="menu-background"
                                       id="switcher-bg-img1" @onclick='() => backgroundImageFn("bgimg2")'
                                       checked="@(currentState?.BackgroundImage == "bgimg2")">
                                <div class="bg-img-container"><img src="../assets/images/menu-bg-images/bg-img2.jpg" alt=""></div>
                            </div>
                            <div class="form-check switch-select menu-img-select m-2">
                                <input class="form-check-input bgimage-input bg-img3" type="radio" name="menu-background"
                                       id="switcher-bg-img2" @onclick='() => backgroundImageFn("bgimg3")'
                                       checked="@(currentState?.BackgroundImage == "bgimg3")">
                                <div class="bg-img-container"><img src="../assets/images/menu-bg-images/bg-img3.jpg" alt=""></div>
                            </div>
                            <div class="form-check switch-select menu-img-select m-2">
                                <input class="form-check-input bgimage-input bg-img4" type="radio" name="menu-background"
                                       id="switcher-bg-img3" @onclick='() => backgroundImageFn("bgimg4")'
                                       checked="@(currentState?.BackgroundImage == "bgimg4")">
                                <div class="bg-img-container"><img src="../assets/images/menu-bg-images/bg-img4.jpg" alt=""></div>
                            </div>
                            <div class="form-check switch-select menu-img-select m-2">
                                <input class="form-check-input bgimage-input bg-img5" type="radio" name="menu-background"
                                       id="switcher-bg-img4" @onclick='() => backgroundImageFn("bgimg5")'
                                       checked="@(currentState?.BackgroundImage == "bgimg5")">
                                <div class="bg-img-container"><img src="../assets/images/menu-bg-images/bg-img5.jpg" alt=""></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="d-flex justify-content-between canvas-footer">
                <a href="javascript:void(0);" id="reset-all" class="btn btn-danger w-100" @onclick='() => reset()'>Reset</a>
            </div>
        </div>
    </div>
</div>

@code
{
    // Estado local de color para el picker (HEX) y para el tema (RGB "r, g, b")
    private string primarycolorHex = "#845ADF";
    private string backgroundColorHex = "#845ADF";
    private string primarycolor = "132,90,223";
    private string Backgroundcolor = "132,90,223";

    private static int Clamp(int v) => v < 0 ? 0 : (v > 255 ? 255 : v);

    public static string RgbToHex(int r, int g, int b) => $"#{Clamp(r):X2}{Clamp(g):X2}{Clamp(b):X2}";

    public static (int R, int G, int B) HexToRgb(string hex)
    {
        var s = (hex ?? string.Empty).Trim().TrimStart('#');
        if (s.Length != 6) throw new ArgumentException("Invalid hex color code.");
        int r = int.Parse(s.Substring(0, 2), NumberStyles.HexNumber, CultureInfo.InvariantCulture);
        int g = int.Parse(s.Substring(2, 2), NumberStyles.HexNumber, CultureInfo.InvariantCulture);
        int b = int.Parse(s.Substring(4, 2), NumberStyles.HexNumber, CultureInfo.InvariantCulture);
        return (r, g, b);
    }

    private async Task PrimaryModal()
    {
        var parameters = new ColorPickerParameters { ColorSelected = primarycolorHex };
        var pickedHex = await ColorPickerService.ShowColorPicker(parameters);
        if (!string.IsNullOrWhiteSpace(pickedHex))
        {
            primarycolorHex = pickedHex;
            var rgb = HexToRgb(primarycolorHex);
            var val = $"{rgb.R}, {rgb.G}, {rgb.B}";
            await JSRuntime.InvokeAsync<string>("interop.setLocalStorageItem", "VyzorprimaryRGB", val);
            await stateService.themePrimaryFn(val);
            primarycolor = val;
            StateHasChanged();
        }
    }

    private async Task BackgroundModal()
    {
        var parameters = new ColorPickerParameters { ColorSelected = backgroundColorHex };
        var pickedHex = await ColorPickerService.ShowColorPicker(parameters);
        if (!string.IsNullOrWhiteSpace(pickedHex))
        {
            backgroundColorHex = pickedHex;
            var rgb = HexToRgb(backgroundColorHex);
            var val = $"{rgb.R}, {rgb.G}, {rgb.B}";
            var val2 = $"{Clamp(rgb.R + 14)}, {Clamp(rgb.G + 14)}, {Clamp(rgb.B + 14)}";
            // Claves coherentes con StateService
            await JSRuntime.InvokeAsync<string>("interop.setLocalStorageItem", "vyzorbgColor", val);
            await JSRuntime.InvokeAsync<string>("interop.setLocalStorageItem", "vyzorbgColor1", val2);
            await stateService.themeBackgroundFn(val, val2, true);
            Backgroundcolor = val;
            StateHasChanged();
        }
    }

    private bool _isInitialized;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            await JSRuntime.InvokeVoidAsync("window.interop.initializeTooltips");

            if (!_isInitialized)
            {
                _isInitialized = true;

                var storedPrimary = await JSRuntime.InvokeAsync<string>("interop.getLocalStorageItem", "VyzorprimaryRGB");
                if (!string.IsNullOrWhiteSpace(storedPrimary))
                {
                    primarycolor = storedPrimary;
                    // Mantener un HEX por defecto para el picker si no lo tenemos calculado
                }

                // Unificar claves con StateService: usar vyzorbgColor / vyzorbgColor1
                var storedBackground = await JSRuntime.InvokeAsync<string>("interop.getLocalStorageItem", "vyzorbgColor");
                if (!string.IsNullOrWhiteSpace(storedBackground))
                {
                    Backgroundcolor = storedBackground;
                }

                StateHasChanged();
            }
        }
    }

    private AppState currentState => stateService.GetAppState();

    void TriggerAction(string actionValue) => ActionService?.TriggerAction(actionValue);

    private async Task colorthemeFn(string val)
    {
        await JSRuntime.InvokeAsync<string>("interop.setLocalStorageItem", "vyzorcolortheme", val);
        await JSRuntime.InvokeAsync<string>("interop.removeLocalStorageItem", "vyzorbgColor");
        await JSRuntime.InvokeAsync<string>("interop.removeLocalStorageItem", "vyzorbgColor1");
        await JSRuntime.InvokeAsync<string>("interop.removeLocalStorageItem", "vyzorMenu");
        await JSRuntime.InvokeAsync<string>("interop.removeLocalStorageItem", "vyzorHeader");
        await JSRuntime.InvokeAsync<string>("interop.removeLocalStorageItem", "vyzorbgimg");
        await JSRuntime.InvokeAsync<string>("interop.removeLocalStorageItem", "vyzorprimaryRGB");
        await stateService.colorthemeFn(val, true);
        StateHasChanged();
    }

    private async Task directionFn(string val)
    {
        await JSRuntime.InvokeAsync<string>("interop.setLocalStorageItem", "vyzordir", val);
        await stateService.directionFn(val);
        StateHasChanged();
    }

    private async Task navigationStylesFn(string val)
    {
        if (scrollService is not null)
        {
            if (val == "vertical")
            {
                scrollService.IsVertical = true;
            }
            else
            {
                scrollService.IsVertical = false;
                await JSRuntime.InvokeAsync<string>("interop.removeLocalStorageItem", "vyzorverticalstyles");
            }
        }
        await JSRuntime.InvokeAsync<string>("interop.setLocalStorageItem", "vyzornavstyles", val);
        await stateService.navigationStylesFn(val, true);
        TriggerAction(val);
        StateHasChanged();
    }

    private async Task layoutStylesFn(string val)
    {
        await JSRuntime.InvokeAsync<string>("interop.setLocalStorageItem", "vyzorverticalstyles", val);
        await JSRuntime.InvokeAsync<string>("interop.removeLocalStorageItem", "vyzormenuStyles");
        await stateService.layoutStylesFn(val);
        StateHasChanged();
    }

    private async Task menuStylesFn(string val)
    {
        if (scrollService is not null)
        {
            scrollService.IsMenuType = val;
        }
        await JSRuntime.InvokeAsync<string>("interop.setLocalStorageItem", "vyzormenuStyles", val);
        await JSRuntime.InvokeAsync<string>("interop.removeLocalStorageItem", "vyzorverticalstyles");
        await stateService.menuStylesFn(val);
        StateHasChanged();
    }

    private async Task pageStyleFn(string val)
    {
        await JSRuntime.InvokeAsync<string>("interop.setLocalStorageItem", "vyzorpageStyle", val);
        await stateService.pageStyleFn(val);
        await JSRuntime.InvokeVoidAsync("interop.applyPageStyleClass");
        StateHasChanged();
    }

    private async Task widthStylessFn(string val)
    {
        await JSRuntime.InvokeAsync<string>("interop.setLocalStorageItem", "vyzorwidthStyles", val);
        await stateService.widthStylessFn(val);
        StateHasChanged();
    }

    private async Task menuPositionFn(string val)
    {
        await JSRuntime.InvokeAsync<string>("interop.setLocalStorageItem", "vyzormenuposition", val);
        await stateService.menuPositionFn(val);
        StateHasChanged();
    }

    private async Task headerPositionFn(string val)
    {
        await JSRuntime.InvokeAsync<string>("interop.setLocalStorageItem", "vyzorheaderposition", val);
        await stateService.headerPositionFn(val);
        StateHasChanged();
    }

    private async Task menuColorFn(string val)
    {
        await JSRuntime.InvokeAsync<string>("interop.setLocalStorageItem", "vyzorMenu", val);
        await stateService.menuColorFn(val);
        StateHasChanged();
    }

    private async Task headerColorFn(string val)
    {
        await JSRuntime.InvokeAsync<string>("interop.setLocalStorageItem", "vyzorHeader", val);
        await stateService.headerColorFn(val);
        StateHasChanged();
    }

    private async Task themePrimaryFn(string val)
    {
        await JSRuntime.InvokeAsync<string>("interop.setLocalStorageItem", "vyzorprimaryRGB", val);
        await stateService.themePrimaryFn(val);
        StateHasChanged();
    }

    private async Task themeBackgroundFn(string val, string val2)
    {
        await JSRuntime.InvokeAsync<string>("interop.setLocalStorageItem", "vyzorbgColor", val);
        await JSRuntime.InvokeAsync<string>("interop.setLocalStorageItem", "vyzorbgColor1", val2);
        await stateService.themeBackgroundFn(val, val2, true);
        StateHasChanged();
    }

    private async Task backgroundImageFn(string val)
    {
        await JSRuntime.InvokeAsync<string>("interop.setLocalStorageItem", "vyzorbgimg", val);
        await stateService.backgroundImageFn(val);
        StateHasChanged();
    }

    private async Task reset()
    {
        await stateService.reset();
        primarycolorHex = "#845ADF";
        backgroundColorHex = "#845ADF";
        primarycolor = "132,90,223";
        Backgroundcolor = "132,90,223";
        StateHasChanged();
    }

    protected override void OnInitialized()
    {
        StateHasChanged();
    }

    protected override async Task OnInitializedAsync()
    {
        stateService.OnStateChanged += RefreshState;
        await base.OnInitializedAsync();
    }

    private async void RefreshState()
    {
        await InvokeAsync(StateHasChanged);
    }
}
