@page "/error/error401"
@layout Components.Layout.CustomLayout
@inject IJSRuntime JS
@inject Microsoft.AspNetCore.Components.NavigationManager NavigationManager
@implements IAsyncDisposable

<div class="page error-bg" style="min-height: 100vh;">
    <div class="error-page-background">
        <img src="../assets/images/media/backgrounds/10.svg" alt="">
    </div>

    <div id="particles-js"></div>

    <div class="row align-items-center justify-content-center g-0 h-100">
        <div class="col-xl-7 col-lg-7 col-md-7 col-12">
            <div class="px-2 text-center">
                <div class="mb-5 text-center">
                    <img src="../assets/images/media/backgrounds/11.png" alt="" class="w-sm-auto h-100 w-100">
                </div>
                <span class="d-block fs-4 text-primary fw-semibold">�Ups! Acceso No Autorizado</span>
                <p class="error-text mb-0">401</p>
                <p class="fs-5 fw-normal mb-0">
                    No tienes los permisos necesarios para ver este recurso. <br>
                    Contacta al administrador si crees que es un error.
                </p>
            </div>
        </div>
    </div>
</div>

@code {
    private bool _scriptsLoaded;
    private IJSObjectReference? _particlesModule;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender && !_scriptsLoaded)
        {
            var baseUri = NavigationManager.BaseUri;

            try
            {
                _particlesModule = await JS.InvokeAsync<IJSObjectReference>(
                    "import", $"{baseUri}assets/js/ui/effects/particles/background-vector.js");

                await _particlesModule.InvokeVoidAsync("mountParticlesBG", "particles-js");

                _scriptsLoaded = true;
                StateHasChanged();
            }
            catch (Exception ex)
            {
                Console.WriteLine($"Error loading particles: {ex.Message}");
            }
        }
    }

    public async ValueTask DisposeAsync()
    {
        if (_particlesModule is not null)
        {
            try
            {
                await _particlesModule.InvokeVoidAsync("unmountParticlesBG", "particles-js");
                await _particlesModule.DisposeAsync();
            }
            catch { }
        }
    }
}